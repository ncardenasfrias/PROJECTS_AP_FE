\documentclass[hidelinks,12pts]{article}
\usepackage[export]{adjustbox}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[title,titletoc]{appendix}
\usepackage{array}
\usepackage[english]{babel}
\usepackage{bbm}
\usepackage{blindtext}
\usepackage{bookmark}
\usepackage{booktabs}
\usepackage{cancel}
\usepackage{caption}
\usepackage{csquotes}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{epigraph}
\usepackage[left]{eurosym}
\usepackage{float}
\usepackage[bottom]{footmisc}
\usepackage[margin=0.9in]{geometry}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{indentfirst}
\usepackage{listings}
\usepackage{lscape}
\usepackage{mathtools}
\usepackage{mdframed}
\usepackage{multirow}
\usepackage{multicol}
\usepackage[sort]{natbib}
\usepackage{parskip}
\usepackage{setspace}
\usepackage{subcaption}
\usepackage{titlesec}
\usepackage{tgpagella}
\usepackage{varwidth}
\usepackage{verbatim} %comment block
\usepackage{wrapfig}
\usepackage[dvipsnames]{xcolor}
\usepackage{xltabular}

\renewcommand{\epigraphsize}{\normalsize}
\setlength{\epigraphwidth}{0.7\textwidth}
\renewcommand{\textflush}{flushright}
\renewcommand{\sourceflush}{flushright}


\renewcommand\appendixpagename{Mathematical Appendix}
\renewcommand{\baselinestretch}{1.45}

\hypersetup{
    colorlinks=true, 
    urlcolor= Violet, 
    linkcolor=Black, 
    citecolor=Blue, 
    filecolor = Blue
    } 

%\usepackage{natbib}
\bibliographystyle{plainnat}
%\bibdata{My Library.bib}
%\usepackage[backend=biber, style=authoryear-icomp]{biblatex}

\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\Prb}{\mathbb{P}}
\DeclareMathOperator{\R}{\mathbb{R}}
\DeclareMathOperator{\N}{\mathbb{N}}
\DeclareMathOperator{\1}{\mathbbm{1}}
\newcommand{\ind}{\perp\!\!\!\!\perp}


\titleformat{\part}{\centering\normalfont\Large\bfseries}{\partname\hspace{5pt}\thepart\hspace{5pt}}{5pt}{--\ }

\titleformat{\part}{\centering\normalfont\Large\bfseries}{\partname\hspace{5pt}\thepart\hspace{5pt}}{5pt}{--\ }

\makeatletter
\def\@fnsymbol#1{\ensuremath{\ifcase#1\or \dagger\or \ddagger\or
   \mathsection\or \mathparagraph\or \|\or **\or \dagger\dagger
   \or \ddagger\ddagger \else\@ctrerr\fi}}
    \makeatother

%code snippets 
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}



\begin{document}

        \title{\scshape{Financial Econometrics 1 - M2 FTD \\ Empirical Applications}}
        \author{Luis Miguel Fonseca \\ Stéphane Eloundou Mvondo\\ Natalia Cárdenas Frías }
        \date{\today}
        \maketitle 

\tableofcontents
\newpage


\section*{Introduction} \addcontentsline{toc}{section}{\protect\numberline{}Introduction}
\textcolor{blue}{something, probably describe how all applications make sense one after the other and what is the research question we could have made ourselves when doing the applications, try to give a coherent look to the whole thing.}

This document compiles all our applications for the Financial Econometrics course. 
Each section represents a specific application, but we tried to make them coherent across them around a broad question: 





\section{Series Dynamics}\label{sec:dynamics}

\subsection{Data}
\textcolor{gray}{\emph{Note:} Depending on each exercise along these applications we might use different series. In this first section, we performed the stationarity and component analysis of all of them to be able to use them rapidly without having to worry about seasonality or the presence of UR. Therefore, this section encompasses more than the 3 series that were asked in the exercise.}

In this work, we focus on the US market.
We use the following series retreived for the most part from FRED with its Python API (FRED tickers are in square brakets) : 

\paragraph{Inflation Expectation [MICH]}
This data series is made public by the University of Michigan from their Survey of Consumers. 
The series represent the median expected value of the percent change in prices over teh next year. 
The series is not seasonally adjusted.


\paragraph{GDP deflator [A191RI1Q225SBEA]}  
As a measure of inflation, we decided to use the implicit price deflator of teh US GDP. 
Unlike measures like the CPI deflators do not consider baskets of goods and therefore are broader measures of the price changes across all the economy that measure teh ratio of the GDP in value and in volume. 
It is a measure produced by the US Bureau of Economic Analysis as a quaterly measure in percent change QoQ. 
The raw series is already seasonally adjusted at an annual rate. 


\paragraph{Unemployment rate [UNRATENSA]}
It represents the share (in percent) of unemployed people over the labor force \footnote{The labor force data in this context encompasses people older than 16, living in continental US, who don't reside in institutions like prisons or homes for the aged, and who are not in active duty in the military.}. 
The source is the 'Current Population Survey (Household Survey)' of the US Bureau of Labor Statistics


\paragraph{FED fund rate}

\paragraph{S\&P 500 price}

\paragraph{Corporate Debt Returns [BAMLCC0A0CMTRIV]}
The series represents the total returns of the debt index ICE Bank of America US Corporate Index value. 
This capitalization-weighted index tracks the performance if teh following debt instruments\footnote{Taken from the \href{https://fred.stlouisfed.org/series/BAMLCC0A0CMTRIV}{FRED's website} }: 
    \begin{itemize}
        \item[-] Of corporate debt issued in USD in the US domestic market with an investment grade rating\footnote{To be considered to have an investment grade ranking to enter the index, the company and the country must be considered investment grade by the average of the ratings of Fitch, S\&P and Moody's.}. It must have a remaining maturity of at least one year, a fixed-coupon and an outstanding amount of at least 250 million dollars.
        \item[-] Of original zero-coupon bonds ussued simultaneously in the US and the Eurobond market. 
        \item[-] Of 144a securities and pay-in-kind securities, including toggle notes, that can only be traded bu qualified institutional buyers with large portfolios. 
        \item[-] Of callable perpetual securities if they are at least one year from the first call date. 
        \item[-] Of fixed-to-floating rate securities if they are callable within the fixed rate period and are at least one year from the last call prior to the date the bond transitions from a fixed to a floating rate security. 
    \end{itemize}

The data's source is ICE Data Indices, and it is a daily series with close prices.
It is not seasonally adjusted. 





\subsection{Unit root and trends}

As for any time series analysis, the first analysis to perform is regarding the presence of unit roots in the series that would make them non-stationary. 
To do so, we perform the Augmented Dickey-Fuller tests that evaluate the presence of a stochastic trend (a unit root), a deterministic trend, and an intercept or drift. 
Importantly, this test requires estimating three equations/specifications because it requires investigating the joint presence of both types of trends and drift, for them to discard elements one by one.
Each specification test a different data generating process of the series. 
For all specifications, the main null hypothesis H0 is that the series exhibits a UR. 
The inference with this test is non-standard and requires to use of corrected critical values to assess significance with the t-statistics. 



\subsubsection{ADF - Test jointly for deterministic and stochastic trend (with drift)}

We first run the following specification to the ADF test to \emph{jointly} investigate the presence of a stochastic and a determinist trend for each series $(X_t)_t$: 
    \begin{equation}
        \Delta X_t = \alpha + \beta t + \gamma X_{t-1} +\sum_{i=1,2,..}\rho_i \Delta X_{t-i} + \varepsilon_t
    \end{equation}
As per usual, the ADF test assumes H0: $\gamma =0$ i.e. a unit root exists and the series is non-stationary.
We use R's built-in function \texttt{ur.df} with \texttt{type='trend'} to get this estimation. This function gives us (i) a regression table per series and (ii) a summary table with the following test statistics: 
    \begin{itemize}
        \item[-] tau3 refers to the t-statistic associated to H0: $\gamma =0$ i.e. the presence of a UR. H1 refers to the absence of said UR.
        \item[-] phi2 refers to the F-statistic associated to H0: $\alpha = \beta = \gamma =0$ \footnote{As with all F test, the alternative hypothesis is that at least one of these coefficients in non-null. Since this is general, we don't explicitly signal the H1 hereafter.}
        \item[-] phi3 is also an F-statistic, now associated to H0: $\beta =\gamma = 0$  
    \end{itemize}
Remark that the critical value in both tables can be a little different. This is because they are sensitive to the number of observations in each series. In Table \ref{tab:adftrend_hyp}, the critical values correspond to those provided directly by R and are associated with $N=500$, while in Table \ref{tab:tstat_trend} we give the values for $N=250$. Since we have 396 data points per series we preferred to refer to the higher critical values but it does not change the analysis done.

Let us examine each series' results, summarized in the following tables: 

\input{TABLES/adf_trend.tex}
%\input{TABLES/prov_adf_trend.tex}
\input{TABLES/adf_tstats_trend.tex}

\paragraph{GDP}
We have $t_\gamma = -2.15 > -3.42$ we cannot reject the presence of a UR (H0). 
We shall note that phi2 ie that all coefficients are null is rejected since $F_{phi2} = 14.496 > 4.71$ while phi3 ($\gamma = \beta =0$) is not ($F_{phi3} = 2.388 < 6.3$). 
This suggest the absence of a deterministic trend which is confirmed when assessing the significance of $\beta$ using the its non-standard critical value $|t_\beta| = 2.094 < 2.79$ (nullity, ie H0 cannot be rejected). 
These results require us to keep testing the series with the next specification of the test. 


\paragraph{Disposable personal income}
Simiarly as before we find $t_\gamma = -2.694 > -3.42$ and we fail to reject H0. 
Regarding the joint nullity tests as before we reject phi2 ($F_{phi2} = 7.88 > 4.71$) and cannot reject phi3 ($F_{phi3} = 3.849 < 6.3$). 
We also fail to reject the nullity of $\beta$ as $|t_\beta| = 2.577 < 2.79$ and we shall test this series moving forward. 


\paragraph{Inflation expectation} 
We find $t_\gamma = -4.65 < -3.43$ we reject H0 ie we can't say that the series has a UR. 
The F-statistics of phi2 and phi3 leads us to reject the their null hypothesis: $F_{phi2} = 7.88 > 4.71$

Note that the F-statistic corresponding to the nullity of all the coefficients of interest (phi2) leads us to reject H0: $\alpha=\beta=\gamma=0$ (same for phi3) , leading us to believe that the series has either a drift and/or a deterministic trend. 
We therefore compare the t-statistics associated with $\alpha$ and $\beta$ to the standard interest threshold (the critical values below Table \ref{tab:tstat_trend} are conditional on having a UR). Since $|t_\alpha|> 1.96$ and $|t_\beta| > 1.96$, we fail to reject the absence of a drift and of a deterministic trend.
%While we fail to reject that $\beta=0$ ($|t_\beta| = 1.35 < 1.95$ i.e. we don't have evidence of the existence of a deterministic trend), we can reject the nullity of $\alpha$ suggesting that we have a drift. 
We conclude that the series is \emph{stationnary with a constant and a deterministic trend}.
    

\paragraph{GDP deflator}
With $t_\gamma = -5.166 < -3.43$, as before we can reject H0 indicating that the series is stationary in levels. 
Since $|t_\alpha| = 2.584 > 1.96$, we reject the nullity of the drift. 
Finally, since $|t_\beta| = 1.154 < 1.96$ we cannot reject the absence of a deterministic trend.  
We conclude that the series is \emph{stationary with a constant}


%\paragraph{Unemployment rate} Since $t_\gamma = -3.346 > -3.43$, we fail to reject H0. We then test the significance of $\beta$ with respect to the non-standard threshold $2.79$ (bilateral test). Once again, the values of the F-statiss of the other two tests phi2 and phi3, lead us to believe that the series has a constant and/or a deterministic trend (we fail to reject both phi2 and phi3). The ADF methodology leads us to use the second specification for this series and discard the existence of a deterministic trend. 



\paragraph{Fed fund rate}  
$t_\gamma = -1.672 > -3.43$, we are in the same situation as the previous series where we cannot reject the existence of a UR. 
Because we cannot reject phi2 nor phi3 ($F_{phi2} = 2.022 <4.71, \: F_{phi3} = 2.927 <6.3$) we need to continue testing this series with the other specifications as we don't reject the existence of a stochastic trend and we cannnot reject the nulity of the trend coefficient ($|t_\beta| = 0.127 < 2.79$).


\paragraph{S\&P500}
Without many surprises for price series, $t_\gamma = -1.949 > -3.43$ and we cannot reject the existence of a UR. 
Moreover, $F_{phi2} = 3.926< 4.71$ and $F_{phi3} = 1.953 < 6.3$ (non-rejection of the null for both tests) leads to conclude that at least one of these coefficients are non-null (note that $t_\beta = 1.696 < 2.79$ and thus we cannot reject the nullity of $\beta$). 
We continue testing this series with the second specification of the test.
%Given the shape of the series, we decided to keep testing the presence of a UR in the second step of the ADF test.
%we do not reject the existence of a deterministic trend and we continue testing.


\paragraph{Corporate debt}
Finally, this series has $t_\gamma = -2.588 > -3.43$, $F_{phi2} = 5.6> 4.71$ and $F_{phi3} = 3.351 < 6.3$. %and $|t_\beta| = 1.696 < 2.79$. 
While we fail to reject the presence of a UR and that both $\gamma$ and $\beta$ are jointly null ($\beta$ is not significant as $|t_\beta| = 2.560 < 2.79$), we get that at least one coefficient is significantly different from zero, hinting to the constant. 
We need to continue to test this series too with the second specification of the ADF test. 







\subsubsection{ADF - Test jointly for stochastic trend and drift}
The second specification of the test models $\forall (X_t)_t$: 
    \begin{equation}
        \Delta X_t = \alpha  + \gamma X_{t-1} +\sum_{i=1,2,..}\rho_i \Delta X_{t-i} + \varepsilon_t
    \end{equation}
The null hypothesis still refers to H0: $\gamma =0$ the presence of a unit root. 
We use now \texttt{type='trend'} in the \texttt{ur.df} function to get this estimation. 
The output of the test is similar to the previous specification and the same remarks on the critical values apply here. 
Now the test statistics reported refer to: 
    \begin{itemize}
        \item[-] tau2 refers to the t-statistic associated to $\gamma =0$ 
        \item[-] phi1 refers to the F-statistic associated to $\alpha = \gamma =0$ 
    \end{itemize}

\input{TABLES/adf_drift.tex}
\input{TABLES/adf_tstats_drift.tex}


\paragraph{Unemployment rate}
With $t_\gamma = -3.334<-2.88$ we reject H0: the series has no unit root.
We then chek the F-statistic associated to $H0: \gamma= \alpha = 0$, i.e. the test \emph{phi1} in the default R test. 
Given that $F_{phi1} = 5.57 > 4.61$, we reject the null suggesting that the series has a constant which is also supported by the significance of $\alpha$, $|t_\alpha| = 3.153 > 1.96$.
Since $\gamma$ is still significantly different from zero using the standard threshold $-1.64$, we finally conclude that the \emph{series is stationary with a constant (no deterministic trend)} at $5\%$. 
%However, the null is not rejected at the one percent level, and by looking at the series it does not look very stationary. Also R's built in function \texttt{order\_integration} concludes that the series is actually non-stationay which made us doubt our results. We decided to continue the test just in case and compare %$t_\gamma$ to the standard -1.64 threshold: since our statistic is larger, we conclude once again that the series is stationary.


\paragraph{Fed fund rate}
Given that $t_\gamma = -2.419 >-2.88$, we cannot reject the null hypothesis. 
We then check the F-statistic of the joint test \emph{phi1}: $F_{phi1} = 3.032 < 4.61$: we cannot reject the null suggesting that the series has a UR and no drift.
Supporting this, we also find that the drift term is not significantly different from zero as $|t_\alpha| = 1.513 < 2.53$.
This leads us to use the third specification of the test.


\paragraph{S\&P500}
Since $t_\gamma = -1.013> -2.87$, we cannot reject H0.
By checking $F_{phi1} = 4.431 <4.61$ and $|t_\alpha| = 1.270 <2.53$, we fall in the same case as before where we need to continue testing the series as it seems to have a UR and no drift


\paragraph{Corporate debt}
For the last series, we find $t_\gamma = -0.383 > -2.87$, leading to a non-rejection of the null hypothesis. 
Once again we check the other two dtstistics: since $F_{phi1} = 5.051 > 4.61$ we reject the joint nullity of $\gamma$ and $\alpha$. 
We then test the significance of the drift coefficient: $|t_\alpha| = 1.824 < 2.53$ and that $\gamma$ is not significantly different fom zero. 
As with the previous series, this result requires us to keep testing the series in the simplest specification of the ADF test. 





\subsubsection{ADF - Test for stochastic trend only}
The last specification of the test keeps only the stochastic trend, $\forall (X_t)_t$: 
    \begin{equation}
        \Delta X_t = \gamma X_{t-1} +\sum_{i=1,2,..}\rho_i \Delta X_{t-i} + \varepsilon_t
    \end{equation}
The null hypothesis still refers to H0: $\gamma =0$ the presence of a unit root and we use \texttt{type='none'}.
The output of the test is similar to the previous ones but now there is only one test statistic reported referring to the null (tau1).
For this step, we only report the table with the t-statistics as its value for the "gamma" row is identical to the test statistics of tau1.

%\input{TABLES/adf_none.tex}
\input{TABLES/adf_tstats_none.tex}

\paragraph{Fed fund rate}
We find $t_\gamma = -1.94> -1.95$ thus we cannot reject the existence of a UR (this is a close call but seems adequate since we never rejected the UR and R's built-in \texttt{order\_integration} also indicates a UR). 
We conclude that the \emph{series has a unit root with no constant nor time trend}.



\paragraph{S\&P500}
Similarly, we find $t_\gamma = 2.690> -1.95$ and we cannot reject H0 and conclude that the \emph{series has a unit root with no constant nor time trend}.


\paragraph{Corporate debt}
Finally, given that $t_\gamma = 2.592> -1.95$ do not reject H0 and conclude that the \emph{series has a unit root with no constant nor time trend}.

%DECOMPOSITION SERIES IN DELTAS 

\begin{figure}[h!]
    \centering
    \includegraphics[width = 0.75\textwidth]{IMAGES/decomposition_iii_deltas.png}
    \caption{Decomposition of the series in deltas}
\end{figure}

\subsubsection{Check stationarity of the series in deltas if UR in levels}

To conclude that the previous three series are indeed I(1), we need to check that the series of their first differences are stationary (i.e. the series in deltas). 
We perform the same ADF procedure to test these transformed series. 

\input{TABLES/adf_deltas.tex}

Table \ref{tab:adfdeltas_hyp} reports the test results in the first specification of the ADF test. 
We easily see that all the $t_\gamma$ (the statistic on tau3) are sufficiently negative to reject H0 and conclude that none of the differentiated series has a UR. 
This is sufficient to conclude that the series on the Fed fund rate, on the returns of the S\&P500, and on the return of corporate debt are indeed \emph{integrated of order one}. 






\subsection{Decomposition of the series}

All (monthly\footnote{One should adapt the number of indicators in the seasonal components according to the data frequency.}) time series de can be decomposed in the following elements: 
    \begin{equation*}
        X_t =  \underbrace{\alpha}_{\text{drift}} + \underbrace{\beta \times t}_{\text{deterministic trend}} + \underbrace{\gamma Tt}_{\text{stochastic trend}} + \underbrace{\Sigma_{i=1}^{11} \rho_i \1_{m_i}}_{\text{seasonality}} + \underbrace{c_i}_{\text{cyclical component}}
    \end{equation*}

Remark that according to definitions, the deterministic might as well include the drift/constants $\alpha$.
Also, distinguishing the presence of a deterministic and stochastic trend needs to be done jointly and with specific procedures (see Section \ref{sec:adf} for the implementation of the ADF unit root tests). 

Using R's built-in function \texttt{stl}\footnote{Seasonal Decomposition of Time Series by Loess}, we can decompose the time series. 
The results are plotted in Figure \ref{fig:decomposition}.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.9\textwidth}
        \centering
        \includegraphics[width=\textwidth]{IMAGES/decomposition_i.png}
        \caption*{}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.9\textwidth}
        \centering
        \includegraphics[width=\textwidth]{IMAGES/decomposition_ii.png}
        \caption*{}
    \end{subfigure}
    \hfill 
    \caption{Time series decomposition}
    \label{fig:decomposition}
\end{figure}


    \subsubsection{Estimationof the parameters in the stationary series}

\begin{comment}
    \subsubsection{Seasonality} \label{sec:adf}

From the decompositions made in the previous section, in Figure \ref{fig:decomposition} we can see that R picks up small seasonal variations in each series (the values on the y-axis are rather very small). 
The estimations of the seasonal coefficients are reported in Table \ref{tab:seasons}, which indeed shows very small coefficients.
We nonetheless decided to work with deseasonalized series even if the changes are minimal.

\input{TABLES/seasons.tex}
\end{comment}





    \subsection{Cyclical component}








\section{Canonical VAR model application}\label{sec:var}

\input{TABLES/varorder_level.tex}

\input{TABLES/estim_var_level.tex}

\section{Cointegration theory}\label{sec:cointegration}




\section{Impulse Response Analysis}\label{sec:irf}
    \subsection{Canonical IRF}\label{sec:canonical_irf}


    \subsection{Structural IRF}\label{sec:structural_irf}



\section{Introduce non-linearities}\label{sec:nonlinearities}
    \subsection{Markov-switching model}\label{sec:markov}

    
    \subsection{STR model}\label{sec:str}



\section{Difference-in-Difference}
https://www.tidy-finance.org/r/difference-in-differences.html
    



\newpage
\begin{appendices}
    
    \section{Code - Data Cleaning} \label{sec:dta_clean}
        %\lstinputlisting[language=python]{DataCleaning.py}
        \lstinputlisting[language=Python]{DataCleaning.py}

\end{appendices}







\end{document}